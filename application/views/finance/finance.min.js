/* Minified JS */
(function(a){a.finance={init:function(){a("#removefromlist").click(function(){a("#namelist :selected").remove()});a("#tabs").tabs({collapsible:true,hide:true});a(".authorise-link").click(function(e){e.preventDefault();url=a(this).attr("href");var c=a(this);var b=a("<div />").addClass("delete-conf-box");b.dialog({resizable:false,draggable:false,modal:true,title:"Authorise",width:500,buttons:{Cancel:function(){a(this).dialog("close")}}});b.html("Loading...");a.ajax({type:"POST",url:url,error:function(){b.dialog("close");a.common.notify("Error...")},success:function(f){b.html(JSON.parse(f).html);b.find(".jcr-form").submit(function(g){g.preventDefault();url=a(this).attr("action");a.ajax({type:"POST",url:url,data:{code:a(this).find("input").val(),authorise:"Authorise"},error:function(){b.dialog("close");a.common.notify("Error...")},success:function(h){console.log(h);location.reload()}})})}});return false});a("input, textarea, select").blur(function(){a(this).addClass("sel")});a("#account-number, #sort-code").on("focus blur keyup",function(){a(this).get(0).setCustomValidity("");if(!a(this).get(0).checkValidity()){a(this).get(0).setCustomValidity("Please enter a valid "+a(this).attr("placeholder")+".")}});a(".claim-edit-form").submit(function(c){if(a("#claim-method").val()==2&&(a("#account-number").val()!="Hidden"||a("#sort-code").val()!="Hidden")){if(typeof(c.isTrigger)=="undefined"){event.preventDefault();var e=a(this);var b=a("<div />").html(a("#account-details-confirmation").html());b.find(".acc-num").html(a("#account-number").val());b.find(".sort-code").html(a("#sort-code").val());b.dialog({resizable:false,draggable:false,modal:true,title:"Check Details",width:300,buttons:{Yes:function(){a(this).dialog("close");a(".claim-edit-form").submit()},Cancel:function(){a(this).dialog("close")}}})}}});a("#print-file").click(function(b){b.preventDefault();window.print()});a(".edit-budgets-accordion").accordion({active:parseInt(a("#index_select").html())});a(".budgetholder").change(function(b){holder=a(this).val();var c=a("#fullnameslist").children();var e=-1;c.each(function(){if(a(this).html()==holder){e=a(this).attr("id")}});a(this).siblings("#budgetholder_id").val(e)});a(".remove-file").click(function(b){b.preventDefault();file=a(this).siblings("#file-name").html();claim_id=a("#claim-id").html();a.ajax({type:"POST",url:script_url+"finance/claims/remove_file",data:{file:file,claim_id:claim_id},error:function(){a.common.notify("This file could not be removed")},success:function(){location.reload()}})});a("#claim-method").change(function(){if(a("#claim-method").val()==2){a("#transfer-details").show();a("#account-number").focus();a("#account-number").attr("required","required");a("#sort-code").attr("required","required")}else{a("#transfer-details").hide();a("#account-number").removeAttr("required");a("#sort-code").removeAttr("required")}});console.log("a");if(a(".finance-feedback").length>0){console.log("a");d=a("<div/>").html("<p>This page is still being worked on, if you have any feedback please click here</p>");a("#content").prepend(d)}a("#sort-code").keyup(function(b){if(b.keyCode>=37&&b.keyCode<=40){return}if(a(this).get(0).selectionStart!=a(this).get(0).selectionEnd){return}pos=a(this).get(0).selectionStart;text=a(this).val();pos-=text.length;text=text.split("-").join("");if(text.length>=3){text=text.substr(0,2)+"-"+text.substr(2)}if(text.length>=6){text=text.substr(0,5)+"-"+text.substr(5)}pos+=text.length;if(pos==2||pos==5){pos++}a(this).val(text);a(this).get(0).setSelectionRange(pos,pos)});a(".button-mark-paid").click(function(b){b.preventDefault();button=a(this);claimid=button.siblings("#claim-id").text();a.ajax({type:"POST",url:script_url+"finance/claims/change_claim_status",data:{claimid:claimid,newstatus:(button[0].innerHTML=="Unmark As Paid"?1:2)},error:function(){a.common.notify("The status could not be updated")},success:function(){button[0].innerHTML=(button[0].innerHTML=="Unmark As Paid"?"Mark Paid":"Unmark As Paid")}})});a(".button-approve-claim").click(function(b){b.preventDefault();button=a(this);claimid=button.siblings("#claim-id").text();a.ajax({type:"POST",url:script_url+"finance/claims/change_claim_status",data:{claimid:claimid,newstatus:1},error:function(){a.common.notify("The status could not be updated")},success:function(){button.siblings("#claim-id")[0].innerHTML="Approved";button.siblings("#claim-id")[0].style.display="";button.parent().siblings(".claim-status").text("Waiting For Payment");button[0].remove()}})});a("#claim-add-budget").submit(function(c){c.preventDefault();var e=a("#nameentry-id").val();var b=a("#newname").val();if(e==""){a("#error-message").html("*Invalid Input")}else{a("#error-message").html("");a.ajax({type:"POST",url:script_url+"finance/claims/add_budget",data:{newname:b,holdername:e},error:function(){a.common.notify("The budget could not be added")},success:function(){a("#budgets-list").append("<li>"+b+" - "+a("#nameentry").val()+"</li>");a("#nameentry-id, #newname, #nameentry").val("");a("#newname").focus()}})}});a("#claim-amount, #invoice-amount").blur(function(b){if(a(this).val().substring(0,1)=="\u00A3"){var c=parseFloat(a(this).val().substring(1))}else{var c=parseFloat(a(this).val())}if(!isNaN(c)){a(this).val("\u00A3"+c.toFixed(2))}else{a(this).val("")}});a(".invoice-paid").click(function(e){e.preventDefault();var c=a(this);var b=c.siblings(".invoice-status").text();a.ajax({type:"POST",url:script_url+"finance/invoices/admin_mark_paid",data:{payment_id:c.siblings(".invoice-id").text(),status:(b=="1"?"0":"1")},success:function(){c.text("Mark as "+(b=="1"?"P":"Unp")+"aid");c.attr("title","Mark This Entry As "+(b=="1"?"P":"Unp")+"aid");c.parent().siblings(".invoice-paid").text(b=="1"?"NO":"YES");c.siblings(".invoice-status").text(b=="1"?"0":"1")},error:function(){a.common.notify("The payment status could not be updated")}})});a("#claim-submit-form").submit(function(e){var b=["claim-name","invoice-amount","claim-item","claim-budget"];var c=["claim-name-helper","invoice-amount-helper","claim-item-helper","claim-budget-helper"];failed=false;for(i=0;i<b.length;i++){if(a("#"+b[i]).val()==""){failed=true;a("#"+c[i])[0].innerHTML="*This Field Is Required"}else{a("#"+c[i])[0].innerHTML=""}}if(failed){e.preventDefault()}});a(".invoice-remove").click(function(e){e.preventDefault();var c=a(this);var b=a("<div />").addClass("delete-conf-box");b.html("Are you sure you want to delete that invoice?<br />");b.dialog({resizable:false,draggable:false,modal:true,title:"Confirm Delete",buttons:{Delete:function(){a.ajax({type:"POST",url:script_url+"finance/claims/remove_invoice/"+c.siblings(".invoice-id").text(),error:function(){a.common.notify("The invoice could not be deleted")},success:function(){c.closest("tr").remove()}});a(this).dialog("close")},Cancel:function(){a(this).dialog("close")}}});return false});a(".invoice-remove-member").click(function(e){e.preventDefault();var c=a(this);var b=a("<div />").addClass("delete-conf-box");b.html("Are you sure you want to remove this member?<br />");b.dialog({resizable:false,draggable:false,modal:true,title:"Confirm Remove",buttons:{Delete:function(){a.ajax({type:"POST",url:script_url+"finance/claims/remove_member/"+c.siblings(".invoice-id").text(),error:function(){a.common.notify("The member could not be removed")},success:function(){c.closest("div").remove()}});a(this).dialog("close")},Cancel:function(){a(this).dialog("close")}}});return false})}}})(jQuery);