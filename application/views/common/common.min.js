var loc=window.location,full_url=loc.protocol+"//"+loc.host+loc.pathname;if(-1==full_url.indexOf("/butler.jcr"))var script_url=loc.protocol+"//"+full_url.substring(full_url.indexOf("://")+3,full_url.indexOf(".co.uk"))+".co.uk/";else var script_url=loc.protocol+"//"+full_url.substring(full_url.indexOf("://")+3,full_url.indexOf("/butler.jcr"))+"/butler.jcr/";view_url=script_url+"application/views/";var ext=".php",scriptVersion="28052014";if(-1!==script_url.indexOf("butler.jcr"))var ga_account="UA-750282-1";jQuery.fn.jsify=function(){this.find('a[href^="'+script_url+'"]').not('a[href*="/application/views/"]').not(".no-jsify").click(function(e){return this.href!=window.loc.href&&$("link[rel=stylesheet]").not('[href*="common.min.css"]').remove(),e.ctrlKey?window.open(this.href,"_blank"):$.common.goTo(this.href),!1});var e=this.find("form").not('[action^="https"]').not(".no-jsify");return e.each(function(){var e=$(this).find("input[type=submit]");e.not('[name=""]').size()>0?e.click($.common.default_submit_handler):$(this).submit($.common.default_submit_handler)}),this},function(e,t){var n={label:"Josephine Butler JCR",duplicate:!1,duration:500,easingOpen:"swing",easingClose:"swing",closedSymbol:"&#9658;",openedSymbol:"&#9660;",prependTo:"body",parentTag:"a",closeOnClick:!1,allowParentLinks:!1},i="slicknav",o="slicknav";e.fn[i]=function(i){return this.each(function(){function a(e){var t=e.data("menu");t||(t={},t.arrow=e.children("."+o+"_arrow"),t.ul=e.next("ul"),t.parent=e.parent(),e.data("menu",t)),e.parent().hasClass(o+"_collapsed")?(t.arrow.html(m.openedSymbol),t.parent.removeClass(o+"_collapsed"),c(t.ul,!0)):(t.arrow.html(m.closedSymbol),t.parent.addClass(o+"_collapsed"),c(t.ul,!0))}function c(e,t){var n=l(e),i=0;t&&(i=m.duration),e.hasClass(o+"_hidden")?(e.removeClass(o+"_hidden"),e.slideDown(i,m.easingOpen),e.attr("aria-hidden","false"),n.attr("tabindex","0"),s(e,!1)):(e.addClass(o+"_hidden"),e.slideUp(i,m.easingClose,function(){e.attr("aria-hidden","true"),n.attr("tabindex","-1"),s(e,!0),e.hide()}))}function s(t,n){var i=t.children("li").children("ul").not("."+o+"_hidden");i.each(n?function(){var t=e(this);t.attr("aria-hidden","true");var i=l(t);i.attr("tabindex","-1"),s(t,n)}:function(){var t=e(this);t.attr("aria-hidden","false");var i=l(t);i.attr("tabindex","0"),s(t,n)})}function l(e){var t=e.data("menu");if(!t){t={};var n=e.children("li"),i=n.children("a");t.links=i.add(n.children("."+o+"_item")),e.data("menu",t)}return t.links}function r(t){t?e("."+o+"_item, ."+o+"_btn").css("outline",""):e("."+o+"_item, ."+o+"_btn").css("outline","none")}var d=e(this),m=e.extend({},n,i);if(m.duplicate){var u=d.clone();u.removeAttr("id"),u.find("*").each(function(t,n){e(n).removeAttr("id")})}else var u=d;var p=o+"_icon";""==m.label&&(p+=" "+o+"_no-text"),"a"==m.parentTag&&(m.parentTag='a href="#"'),u.attr("class",o+"_nav");var h=e('<div class="'+o+'_menu"></div>'),f=e("<"+m.parentTag+' aria-haspopup="true" tabindex="0" class="'+o+'_btn"><span class="'+o+'_menutxt">'+m.label+'</span><span class="'+p+'"><span class="'+o+'_icon-bar"></span><span class="'+o+'_icon-bar"></span><span class="'+o+'_icon-bar"></span></span></a>');e(h).append(f),e(m.prependTo).prepend(h),h.append(u);var g=u.find("li");e(g).each(function(){var t=e(this);if(data={},data.children=t.children("ul").attr("role","menu"),t.data("menu",data),data.children.length>0){var n=t.contents(),i=[];e(n).each(function(){return e(this).is("ul")?!1:void i.push(this)});{e(i).wrapAll("<"+m.parentTag+' role="menuitem" aria-haspopup="true" tabindex="-1" class="'+o+'_item"/>').parent()}t.addClass(o+"_collapsed"),t.addClass(o+"_parent"),e(i).last().after('<span class="'+o+'_arrow">'+m.closedSymbol+"</span>")}else 0==t.children().length&&t.addClass(o+"_txtnode");t.children("a").attr("role","menuitem").click(function(){m.closeOnClick&&e(f).click()})}),e(g).each(function(){var t=e(this).data("menu");c(t.children,!1)}),c(u,!1),u.attr("role","menu"),e(t).mousedown(function(){r(!1)}),e(t).keyup(function(){r(!0)}),e(f).click(function(e){e.preventDefault(),c(u,!0)}),u.on("click","."+o+"_item",function(t){t.preventDefault(),a(e(this))}),e(f).keydown(function(e){var t=e||event;13==t.keyCode&&(e.preventDefault(),c(u,!0))}),u.on("keydown","."+o+"_item",function(t){var n=t||event;13==n.keyCode&&(t.preventDefault(),a(e(t.target)))}),m.allowParentLinks&&e("."+o+"_item a").click(function(e){e.stopImmediatePropagation()})})},e.common={big_title:'<span class="big-text-medium">BUTLER JCR</span>',"short":"",cur_url:"",old_url:"",cache_urls:[],cache:[],scripts:[],inits:[],to_init:[],js_loading_count:0,addrchange:!0,currently_loading:!1,init:function(){if(e(".slicknav_menu").length<1&&e("#navmob").slicknav(),e(document).jsify(),e("#content").on("click",".admin-delete-button",e.common.conf_delete),"undefined"==typeof history_loaded&&(History.Adapter.bind(window,"statechange",function(){-1!==script_url.indexOf("dur.ac.uk")&&_gaq.push(["_trackPageview",History.getState().hash]),e.common.addrchange&&e.common.loader(History.getState().url)}),history_loaded=!0),e("head").find("script").each(function(){e.common.scripts.push(this.src),e.common.add_init(this.src)}),newline=String.fromCharCode(10),e("textarea").each(function(){e(this).html(e(this).html().split("\\n").join(newline))}),e(".add-bg").click(function(t){t.preventDefault(),e("html").addClass("bg"),e(".add-bg-link").remove()}),e(".show-survey").length>0&&(box_content='<img src="http://ohdoylerules.com/content/images/googleforms.png" width="100px" style="float:left;padding-right:10px;">',box_content+="<p>Would you like to fill in an anonymous survey about this site?</p>",box_content+="<p>It'll help us keep the content on this site useful and relivent to you and it'll only take a couple of minutes of your time.</p>",e("<div/>").html(box_content).dialog({buttons:[{text:"Ok",click:function(){window.open("https://docs.google.com/forms/d/1uVEn0JS9VV6uL3IdQ8yMiiUBdv0yo7br2o9HPTjJfvQ/viewform?usp=send_form"),e(this).dialog("close"),e.ajax({type:"POST",url:location.href,data:{surveycomplete:"done"}})}},{text:"No Thank You",click:function(){e(this).dialog("close"),e.ajax({type:"POST",url:location.href,data:{surveycomplete:"skip"}})}}],title:"Butler JCR Website Survey",width:"400px",modal:!0,draggable:!1,resizable:!1,show:"drop",hide:!0})),e(".print-page").click(function(e){e.preventDefault(),window.print()}),e("#cookie-popup").length>0&&(message=e("#cookie-popup").html(),e("<div></div>").dialog({modal:!0,resizable:!1,open:function(){e(this).html(message)},buttons:{Ok:function(){e(this).dialog("close"),e.ajax({type:"POST",url:script_url+"home/cookie_prompt"}),e(window).width()>900}},close:function(){e.ajax({type:"POST",url:script_url+"home/cookie_prompt"})}})),e(".no-profile-image").length>0&&e(window).width()>900&&(window.scrollTo(0,0),layer=e("<div/>").addClass("spesificPropertiesDiv upper-layer").appendTo(e("body")),arrow=e("<div/>").addClass("arrow upper-layer").appendTo(e("body")),e("<div/>").html("Did you know you can edit your profile photo by clicking here?").addClass("prompt-text").appendTo(arrow),link=e("<a/>").appendTo(e("body")).addClass("profile-link upper-layer"),link.attr("href",script_url+"details/profile"),profile=e("<div/>").addClass("upper-profile-photo upper-layer").appendTo(link),existing=e("#header-profile"),profile.css("background-image",existing.css("background-image")),profile.css("margin",existing.css("margin")),profile.css("padding",existing.css("padding")),profile.css("height",existing.height()),profile.css("width",existing.width()),profile.css("top",existing.position().top),profile.css("left",existing.position().left),arrow.css("left",e("#login-details").position().left-arrow.width()),arrow.css("top",10),e(".spesificPropertiesDiv, .upper-layer").click(function(){e(".upper-layer").remove(),e.ajax({type:"POST",url:script_url+"details/profile"})})),e("#nameentry").length>0){var t=[];e("#users-list").children("p").each(function(){t.push({value:e(this).text(),id:e(this).attr("value")})}),e("#nameentry").autocomplete({source:t,change:function(t,n){e("#nameentry-id").val(null==n.item?"":n.item.id)}})}var n,i=e("#uploads .year-title");i.click(function(){n=e(this).siblings("table"),n.is(":visible")?(n.hide(),e(this).find(".file-arrow").removeClass("file-rotate")):(n.show(),e(this).find(".file-arrow").addClass("file-rotate"))}),i.siblings(".file-table").not(":first").hide(),e.common.js_init(),e.common.interface()},move_v_mouse:function(t,n){e("#vmouse").animate({top:t.offset().top+t.height()/2,left:t.offset().left+t.width()/2},{complete:n})},tutorial:function(){setTimeout(function(){window.scrollTo(0,0),endlink=window.location.href,layer=e("<div/>").addClass("spesificPropertiesDiv upper-layer tutorial").appendTo(e("body")),textprompt=e("<div/>").appendTo(e("body")).addClass("text-display"),textprompt.html("Let me show you around..."),e(".link-head").eq(0).click(),numclicks=0,layer.click(function(){numclicks+=1,1==numclicks?(layer.animate({opacity:.2}),mouse=e("<div/>").attr("id","vmouse").appendTo(e("body")),textprompt.html("Do you want to know who we are?"),setTimeout(function(){e("#sub-menu").find("tr").mouseleave(),e.common.move_v_mouse(e(".heading").eq(1),function(){e(".link-head").eq(1).mouseenter(),e(".link-head").eq(1).click()})},200)):2==numclicks?(textprompt.html("Or do you want to know what we have on?"),setTimeout(function(){e(".link-head").eq(1).mouseenter(),setTimeout(function(){e.common.move_v_mouse(e(".heading").eq(1).find("tr").eq(0),function(){e(".link-head").eq(1).mouseleave(),e(".heading").eq(1).find("tr").eq(0).mouseenter(),setTimeout(function(){e.common.move_v_mouse(e("#sub-menu").find("tr").eq(0),function(){e("#sub-menu").find("tr").eq(0).mouseenter(),e.common.move_v_mouse(e("#sub-menu").find("tr").eq(1),function(){e("#sub-menu").find("tr").eq(0).mouseleave(),e(".heading").eq(1).find("tr").eq(0).mouseenter(),setTimeout(function(){e("#sub-menu").find("tr").eq(1).mouseenter(),e("#sub-menu").find("tr").eq(1).click()},30)})})},200)})},200)},200)):3==numclicks?(textprompt.html("And what we are up to?"),setTimeout(function(){e.common.move_v_mouse(e(".heading").eq(1).find("tbody").eq(0).children("tr").eq(5),function(){e(".heading").eq(1).find("tbody").eq(0).children("tr").eq(5).mouseenter(),setTimeout(function(){e.common.move_v_mouse(e("#sub-menu").find("tr").eq(0),function(){e("#sub-menu").find("tr").eq(0).mouseenter(),e("#sub-menu").find("tr").eq(0).click()})},30)})},200)):4==numclicks?(textprompt.html("Do you fancy coming back?"),setTimeout(function(){e("#sub-menu").find("tr").mouseleave(),e.common.move_v_mouse(e(".heading").eq(5),function(){e(".link-head").eq(3).mouseenter(),e(".link-head").eq(3).click()})},200)):5==numclicks?(textprompt.html("Or have you never been here before?"),setTimeout(function(){e("#sub-menu").find("tr").mouseleave(),e.common.move_v_mouse(e(".heading").eq(6),function(){e(".link-head").eq(4).mouseenter(),setTimeout(function(){e.common.move_v_mouse(e(".heading").eq(6).find("tr").eq(2),function(){e(".link-head").eq(4).mouseleave(),e(".heading").eq(6).find("tr").eq(2).mouseenter(),e(".heading").eq(6).find("tr").eq(2).click()})},200)})},200)):6==numclicks?(layer.animate({opacity:.2}),textprompt.html("Enjoy..."),setTimeout(function(){e("#sub-menu").find("tr").mouseleave(),e.common.move_v_mouse(e(".heading").eq(0),function(){e(".link-head").eq(0).mouseenter(),e(".link-head").eq(0).click(),setTimeout(function(){mouse.remove(),e(".link-head").eq(0).mouseleave(),e("#sub-menu").find("tr").mouseleave()},300)})},200)):7==numclicks&&(layer.remove(),mouse.remove(),textprompt.remove(),window.location.href=endlink)})},200)},"interface":function(){e(".apt, .input-help, .jcr-button").tooltip({open:function(){e(".ui-tooltip").length>1&&e(".ui-tooltip").not(":last").remove()}}),e(".datepicker").datepicker({dateFormat:"dd/mm/yy",duration:"fast",firstDay:1,numberOfMonths:2,beforeShow:function(){e(".ui-tooltip").remove()}}),e("#accordion").accordion({heightStyle:"content",collapsible:!0}),e(".page-content-area").each(function(){e(this).siblings("input.page-rights").val()>0&&e.common.editorButton(e(this))}),e("a.photo-thumb").length>0&&(e("a.photo-thumb").click(function(t){e.common.sbClick(e(this).index("a.photo-thumb")),e(document).on("keydown.g",function(t){"27"==t.which?(t.preventDefault(),e.common.sbCancel()):"37"==t.which?(t.preventDefault(),e.common.sbPrev()):"39"==t.which&&(t.preventDefault(),e.common.sbNext())}),t.preventDefault()}),e(document).on("click",".sb-cancel",function(t){e.common.sbCancel(),t.preventDefault()}),e(document).on("click",".sb-next-on",function(t){e.common.sbNext(),t.preventDefault()}),e(document).on("click",".sb-prev-on",function(t){e.common.sbPrev(),t.preventDefault()}))},goTo:function(e){-1!==script_url.indexOf("butler.jcr")?History.pushState(null,null,"/butler.jcr/"+e.substring(script_url.length)):History.pushState(null,null,e.substring(script_url.length-1))},loader:function(t,n){if(null!==t){var i=e.inArray(t,e.common.cache_urls);if(-1!=i&&!n)return void e.common.load_page(e.common.cache[i]);e.common.big_title=e("#big-title").html(),e.common.short=e("#nav").attr("class"),e.common.old_url=e.common.cur_url,e.common.cur_url=t,e(".slicknav_nav").is(":visible")&&e(".slicknav_btn").click(),e(".mce-tinymce").length>0&&tinymce.remove("#page-content-area"),e("#content-area").hide(),e("#spinner").show(),e.common.set_page_attributes('<span class="big-text-medium">BUTLER JCR</span>',""),e.ajax({url:t,type:null==n?"GET":"POST",cache:!1,dataType:"json",data:n,error:function(){e.common.cur_url=e.common.old_url,e.common.old_url="",e("#spinner").hide(),e("#content-area").show(),e.common.set_page_attributes(e.common.big_title,e.common.short,"Error"),e.common.notify("The requested page could not be loaded. Please check your internet connection and try again.")},success:e.common.load_page})}},notify:function(t){e("<div></div>").dialog({modal:!0,resizable:!1,open:function(){e(this).html(t)},buttons:{Ok:function(){e(this).dialog("close")}}})},load_page:function(t){for(var n in e.common.inits)e[e.common.inits[n]].unload&&e[e.common.inits[n]].unload();if("object"!=typeof t){try{var i=e.parseJSON(t)}catch(o){return e("#content").html(t),e("#spinner").hide(),void e("#content-area").show()}t=i}if(t.redirect)return void(window.location=t.redirect);if(e.common.currently_loading=!0,t.keep_cache&&!t.from_cache){if(e.isArray(t.keep_cache))for(var n in t.keep_cache)if(script_url+t.keep_cache[n]==e.common.cur_url){t.keep_cache=!0;break}if(t.keep_cache===!0){var a=e.common.cache_urls.push(e.common.cur_url)-1;e.common.cache[a]=e.extend(!0,{},t),e.common.cache[a].from_cache=!0}}t.css&&!t.from_cache&&e(t.css).each(function(t,n){0==e("head").find('link[href="'+n+'"]').size()&&e("head").append(e("<link />",{rel:"stylesheet",href:n}))}),e.common.inits=[],t.js&&(e.common.js_loading_count=0,e.each(t.js,function(t,n){-1==e.inArray(n,e.common.scripts)?(e.common.js_loading_count++,e.common.get_script(n,function(){e.common.scripts.push(n),e.common.add_init(n),e.common.js_loading_count--,e.common.js_init()})):e.common.add_init(n)}),0==e.common.js_loading_count?e.common.js_init():e.common.to=setTimeout(function(){e.common.js_init(!0)},5e3)),e("#content").html(t.html).jsify(),t.from_cache?e.common.finish_loading(t):e.common.preload_images(e("#content-area img"),function(){e.common.finish_loading(t)})},get_script:function(t,n){var i=e("head")[0],o=document.createElement("script");o.src=t;var a=!1;return o.onload=o.onreadystatechange=function(){a||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a=!0,n&&n(),o.onload=o.onreadystatechange=null)},void i.appendChild(o)},add_init:function(t){var n=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf("."));-1==n.indexOf("-")&&"common"!=n&&e[n]&&e[n].init&&e.common.inits.push(String(n))},finish_loading:function(t){e.common.set_page_attributes(t.big_title,t.short,t.title),e("#spinner").hide(),e("#content-area").show(),e.common.currently_loading=!1,e.common.interface(),"undefined"!=typeof twttr&&twttr.widgets.load(),e.common.js_init()},set_page_attributes:function(t,n,i){e("#big-title").html(t),e("#nav").attr("class",n),i&&(document.title="Butler College JCR - "+i)},js_init:function(t){if(t===!0&&(e.common.js_loading_count=0),0==e.common.js_loading_count&&e.common.currently_loading===!1){clearTimeout(e.common.to),delete e.common.to;for(var n in e.common.inits)e[e.common.inits[n]].init();e(document).trigger("common_loading_finished")}},preload_images:function(t,n){var i=[],o=!1,a=!1,c=!1;t.each(function(s){o=!0;var l=this.src;i.push(l);var r=new Image;e(r).load(function(){var t=e.inArray(l,i);i.splice(t,1),a&&i.length<=0&&(n.call(),clearTimeout(e.common.fin),c=!0)}),s==t.length-1&&(a=!0),r.src=l}),c||(o?e.common.fin=setTimeout(n,5e3):setTimeout(n,10))},default_submit_handler:function(){var t=e(this).closest("form"),n=t.attr("action");if(-1!==n.indexOf("https"))return!0;var i=t.serializeArray();return this.name&&i.push({name:this.name,value:this.value}),e.common.post_data_change_url(n,i),!1},post_data_change_url:function(t,n){e.common.addrchange=!1,e.common.goTo(t),e.common.loader(t,n),e.common.addrchange=!0},print:function(){return window.print(),!1},conf_delete:function(){var t=e("<div />").addClass("delete-conf-box");t.html("Are you sure you want to delete that?<br />");var n=this;return t.dialog({resizable:!1,draggable:!1,modal:!0,title:"Confirm Delete",buttons:{Delete:function(){e.common.goTo(n.href),e(this).dialog("close")},Cancel:function(){e(this).dialog("close")}}}),!1},sbClick:function(t){e("body").append('<div class="smoothbox"><div class="smoothbox-table"><div class="smoothbox-centering"><div class="smoothbox-sizing"><div class="sb-nav"><a href="#" class="sb-prev sb-prev-on" alt="Previous">&larr;</a><a href="#" class="sb-cancel" alt="Close">&times;</a><a href="#" class="sb-next sb-next-on" alt="Next">&rarr;</a></div><ul class="sb-items"></ul></div></div></div></div>'),e.fn.reverse=[].reverse,e("a.photo-thumb").reverse().each(function(){var t=e(this).attr("href");if(e(this).attr("title")){var n=e(this).attr("title");e(".sb-items").append('<div class="sb-item"><div class="sb-caption">'+n+'</div><img src="'+t+'"/></div>')}else e(".sb-items").append('<div class="sb-item"><img src="'+t+'"/></div>')}),e(".sb-item").slice(0,-t).appendTo(".sb-items"),e(".sb-item").not(":last").hide(),e(".sb-item img:last").load(function(){e(".smoothbox-sizing").fadeIn("slow",function(){e(".sb-nav").fadeIn()})})},sbCancel:function(){e(document).unbind("keydown.g"),e(".smoothbox").fadeOut("slow",function(){e(".smoothbox").remove()})},sbNext:function(){e(".sb-next").removeClass("sb-next-on"),e(".sb-item:last").addClass("sb-item-ani"),e(".sb-item:last").bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){e(".sb-item").eq(-2).addClass("no-trans").fadeIn("fast"),e(this).removeClass("sb-item-ani").prependTo(".sb-items").hide(),e(".sb-item:last").removeClass("no-trans"),e(".sb-next").addClass("sb-next-on"),e(".sb-item").unbind()})},sbPrev:function(){e(".sb-prev").removeClass("sb-prev-on"),e(".sb-item:last").hide(),e(".sb-item:first").addClass("sb-item-ani2 no-trans").appendTo(".sb-items"),e(".sb-item:last").show().removeClass("no-trans").delay(1).queue(function(t){e(".sb-item:last").removeClass("sb-item-ani2"),t()}),e(".sb-prev").addClass("sb-prev-on")},editorButton:function(t){c=e("<button />",{"class":"jcr-button editable-launch",title:"Edit this content"}).click(function(){"undefined"==typeof tinymce?(e.ajax({url:view_url+"common/tinymce/tinymce.min.js?v="+scriptVersion,dataType:"script",cache:!0,success:function(){e.common.launchEditor(t)},error:function(){e.common.notify("The page editor could not be loaded.")}}),e("head link[rel='stylesheet']").last().after("<link rel='stylesheet' href='"+view_url+"common/editable/editable.css?v="+scriptVersion+"' type='text/css'>")):e.common.launchEditor(t)}).hover(function(){t.addClass("editable-border")},function(){t.removeClass("editable-border")}).append(e("<span />",{"class":"ui-icon ui-icon-pencil"})).tooltip().insertBefore(t)},launchEditor:function(t){t.siblings(".editable-launch").remove(),t.removeClass("editable-border");var n=t.html();tinymce.baseURL=view_url+"common/tinymce",tinymce.suffix=".min",t.attr("id","page-content-area"),tinymce.init({selector:"#page-content-area",theme:"modern",content_css:view_url+"common/common.min.css?v="+scriptVersion,relative_urls:!1,convert_urls:!1,plugins:["save paste link autolink"],menubar:!1,toolbar:"save cancel | undo redo | cut copy paste | styleselect | bold italic underline | bullist numlist | link insertimage insertdoc insertcontact",style_formats:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Paragraph",format:"p"},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}],statusbar:!0,save_enablewhendirty:!1,save_onsavecallback:function(){e.ajax({type:"POST",url:script_url+"editable_c/save_page/"+e("#page-content-area").siblings(".page-name").val(),dataType:"json",data:{content:tinymce.get("page-content-area").getContent(),file_path:e("#page-content-area").siblings(".page-path").val(),auth:e("#page-content-area").siblings(".page-auth").val()},success:function(t){return t=JSON.parse(t.html),"object"!=typeof t?void console.log(t):void(t.success?(tinymce.remove("#page-content-area"),t.replaceWith&&e("#page-content-area").html(t.replaceWith),e.common.editorButton(e("#page-content-area")),e("#page-content-area").attr("id","")):console.log("sOmething went wr0ng"))},error:function(){e.common.notify("Your changes could not be saved.")}})},save_oncancelcallback:function(){tinymce.remove("#page-content-area"),e("#page-content-area").html(n),e.common.editorButton(e("#page-content-area")),e("#page-content-area").attr("id","")},setup:function(t){t.addButton("insertimage",{icon:"image",tooltip:"Insert image",onclick:function(){e.common.editorImage(t,!1)}}),t.addButton("insertdoc",{icon:"newdocument",tooltip:"Insert document",onclick:function(){e.common.editorDoc(t)}}),t.addButton("insertcontact",{text:"Contact",tooltip:"Insert contact link",onclick:function(){e.common.editorContact(t)}})}})},editorImage:function(t){var n;e("<div />",{"class":"editable-image-create"}).dialog({title:"Insert Image",resizable:!1,modal:!0,width:550,open:function(){var i=e(this);e(".editable-image-create").append('<h3>Enter URL</h3><div class="editable-image-create-inserturl"></div><h3>Upload Image</h3><div><iframe id="editable-image-iframe"></iframe></div><h3>Insert Existing Image</h3><div class="editable-image-create-content"></div>').accordion({collapsible:!0,heightStyle:"content",create:function(){var o=e(this);e(".editable-image-create-inserturl").append(e("<input />",{type:"text",value:"http://"}).focus().add(e("<input />",{type:"button",value:"Insert"}).click(function(){var o=this;n=e(this).siblings("input").val();var a=new Image;a.onerror=function(){e(o).siblings("p").addClass("red").text("Invalid Image")},a.onload=function(){t.insertContent('<img src="'+n+'"/>'),i.dialog("close")},0==e(this).siblings("p").size()?e(this).parent().prepend(e("<p>Checking...</p>")):e(this).siblings("p").text("Checking...").removeClass("red"),a.src=n})));var a=e("#spinner").clone().attr("id","dialog-spinner").show();e(".editable-image-create-content").html(a),e.common.getExistingImages(i,t);var c=e("<form />",{action:script_url+"editable_c/save_image/"+e("#page-content-area").siblings(".page-name").val(),method:"post","accept-charset":"utf-8",enctype:"multipart/form-data"}).append('<input type="file" name="image"><input type="submit" value="Upload"><input type="hidden" name="auth" value="'+e("#page-content-area").siblings(".page-auth").val()+'">');e("#editable-image-iframe").contents().find("body").html(c),e("#editable-image-iframe").load(function(){e(this).contents().find("body").append(c);var n=e("#editable-image-iframe").contents().find(".editable-error");n.length>0?(n.remove(),e("#editable-image-iframe").before(n),o.accordion({active:1})):(o.accordion({active:2}),e.common.getExistingImages(i,t))})}})},close:function(){e(this).dialog("destroy").remove()}})},getExistingImages:function(t,n){e.ajax({dataType:"html",url:script_url+"editable_c/load_page_images/"+e("#page-content-area").siblings(".page-name").val(),data:{auth:e("#page-content-area").siblings(".page-auth").val()},success:function(i){e(".editable-image-create-content").html(JSON.parse(i).html),e(".editable-image-create-addexisting li").click(function(){var i=e(this).find("img").attr("src").replace("_thumb","");n.insertContent('<img src="'+i+'"/>'),t.dialog("close")}),e(".editable-image-create-remove").click(function(t){t.stopPropagation();var n=e(this).siblings("img").attr("src"),i=n.replace("_thumb",""),o=e("<div />").addClass("delete-conf-box");o.html("Are you sure you want to delete that image?<br />"),o.dialog({resizable:!1,draggable:!1,modal:!0,title:"Confirm Delete",buttons:{Delete:function(){e.post(script_url+"editable_c/delete_image/"+e("#page-content-area").siblings(".page-name").val(),{image:i.substring(i.lastIndexOf("/")+1)},function(){e(".editable-image-create-content").find('img[src="'+n+'"]').closest("li").remove(),""==e(".editable-image-create-content").find("ul").html()&&e(".editable-image-create-content").prepend("<h3>No images exist</h3>")}),e(this).dialog("close")},Cancel:function(){e(this).dialog("close")}},close:function(){e(this).dialog("destroy").remove()}})})}})},editorDoc:function(t){e("<div />",{"class":"editable-doc-create"}).dialog({title:"Insert Document",resizable:!1,modal:!0,width:450,open:function(){var n=e(this);e(".editable-doc-create").append('<h3>Upload Document</h3><div><iframe id="editable-doc-iframe"></iframe></div><h3>Insert Existing Document</h3><div class="editable-doc-add"></div>').accordion({collapsible:!0,heightStyle:"content",create:function(){var i=e(this),o=e("#spinner").clone().attr("id","dialog-spinner").show();e(".editable-doc-add").html(o),e.common.getExistingDocs(n,t);var a=e("<form />",{action:script_url+"editable_c/save_doc/"+e("#page-content-area").siblings(".page-name").val(),method:"post","accept-charset":"utf-8",enctype:"multipart/form-data"}).append('<input type="file" name="doc"><input type="submit" value="Upload">');e("#editable-doc-iframe").contents().find("body").html(a),e("#editable-doc-iframe").load(function(){e(this).contents().find("body").append(a);var o=e("#editable-doc-iframe").contents().find(".editable-error");o.length>0?(o.remove(),e("#editable-doc-iframe").before(o),i.accordion({active:0})):(i.accordion({active:1}),e.common.getExistingDocs(n,t))})}});var i=e("#spinner").clone().attr("id","dialog-spinner").show();e(".editable-doc-add").html(i),e.common.getExistingDocs(n,t)},close:function(){e(this).dialog("destroy").remove()}})},getExistingDocs:function(t,n){e.ajax({dataType:"html",url:script_url+"editable_c/load_page_docs/"+e("#page-content-area").siblings(".page-name").val(),data:{auth:e("#page-content-area").siblings(".page-auth").val()},cache:!1,success:function(i){e(".editable-doc-add").html(i),e(".editable-doc-create li").click(function(){t.dialog("close"),url=e(this).find(".editable-doc-create-url").text(),file=e(this).find(".editable-doc-create-full-filename").text(),n.insertContent('<a class="no-jsify" href="'+url+'">'+file+"</a>")}),e(".editable-doc-create-remove").click(function(t){t.stopPropagation();var n=e(this).siblings(".editable-doc-create-details").children(".editable-doc-create-url").text(),i=e(this).siblings(".editable-doc-create-details").children(".editable-doc-create-full-filename").text(),o=e("<div />").addClass("delete-conf-box");o.html("Are you sure you want to delete "+i+"?<br />"),o.dialog({resizable:!1,draggable:!1,modal:!0,title:"Confirm Delete",buttons:{Delete:function(){e.post(script_url+"editable_c/delete_doc/"+e("#page-content-area").siblings(".page-name").val(),{doc:i},function(){e(".editable-doc-add").find("div.editable-doc-create-url:contains("+n+")").closest("li").remove(),""==e(".editable-doc-add").find("ul").html()&&e(".editable-doc-add").prepend("<h3>No documents exist</h3>")}),e(this).dialog("close")},Cancel:function(){e(this).dialog("close")}},close:function(){e(this).dialog("destroy").remove()}})})}})},editorContact:function(t){var n;e("<ul />",{"class":"editable-function-insert-params"}).dialog({title:"Insert Contact Link",resizable:!1,modal:!0,width:400,buttons:{Insert:function(){var i=[];e(".editable-function-insert-params li").each(function(){var t=e(this).find("input, select"),o=n.get_exec_contact.params[t.attr("name")],a="bool"==o.type?t.attr("checked")?1:0:t.val();i.push("'"+a+"'")}),t.insertContent("{get_exec_contact: "+i.join(", ")+"}"),e(this).dialog("close")}},open:function(){var t=e("#spinner").clone().attr("id","dialog-spinner").show();e(".editable-function-insert-params").before(t),e.getJSON(script_url+"editable_c/get_page_functions/"+e("#page-content-area").siblings(".page-name").val(),function(t){n=t;var i=function(t,n,i){return"bool"==n?e("<input />",{id:"editable-contact-link-"+t,type:"checkbox",name:t,value:"1"}):"select"==n?e("<select />",{id:"editable-contact-link-"+t,name:t}).append(i):void 0},o=e();e.each(n.get_exec_contact.params,function(t){"undefined"==typeof this.options&&(this.options=null),o=o.add(e("<li />").append(e("<label />",{"for":"editable-contact-link-"+t}).html(this.desc)).append(i(t,this.type,this.options)))}),e("#dialog-spinner").remove(),e(".editable-function-insert-params").html(o)})},close:function(){e(this).dialog("destroy").remove()}})}},e(document).ready(e.common.init)}(jQuery,document,window);